everything that's not implemented yet

but first:
fix leaks
add tests for everything currently implemented
